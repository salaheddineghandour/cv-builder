<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Master Suite Fixed</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL VARIABLES --- */
        :root {
            --primary: #4f46e5;
            --secondary: #818cf8;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light);
            height: 100vh;
            overflow: hidden;
        }

        /* --- PAGE SWITCHING LOGIC (THE FIX) --- */
        /* By default, pages are hidden */
        .page { 
            display: none !important; 
            height: 100vh; 
            width: 100%; 
        }
        
        /* When active, we force them to show using flex */
        .page.active { 
            display: flex !important; 
        }

        /* --- PAGE 1: LANDING --- */
        #landing-page {
            background: linear-gradient(135deg, var(--dark) 0%, #111827 100%);
            color: white;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .hero-title { font-size: 4rem; margin: 0; background: -webkit-linear-gradient(#818cf8, #c7d2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-subtitle { font-size: 1.5rem; color: #9ca3af; margin-bottom: 40px; }
        .btn-main { padding: 15px 40px; font-size: 1.2rem; background: var(--primary); color: white; border: none; border-radius: 50px; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px rgba(79, 70, 229, 0.4); }
        .btn-main:hover { transform: translateY(-3px); background: var(--secondary); }

        /* --- PAGE 2: LOGIN --- */
        #login-page { 
            background: var(--light); 
            align-items: center; 
            justify-content: center; 
        }
        .login-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; background: #f9fafb; box-sizing: border-box;}
        
        /* --- PAGE 3: THE APP --- */
        #app-page { 
            flex-direction: row; 
        }
        
        /* LEFT: EDITOR PANEL */
        .editor {
            width: 450px;
            background: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100vh;
            box-sizing: border-box;
        }

        .section-header { font-size: 1.1rem; font-weight: bold; margin-top: 20px; color: var(--dark); border-bottom: 2px solid var(--light); padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-family: inherit; font-size: 0.9rem; margin-bottom: 10px; transition: 0.2s; box-sizing: border-box; }
        input:focus { outline: none; border-color: var(--primary); }
        
        .dynamic-item { background: #f9fafb; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; position: relative; margin-bottom: 10px; }
        .btn-del { position: absolute; top: 10px; right: 10px; color: #ef4444; border: none; background: none; cursor: pointer; font-weight: bold; }
        .btn-add { width: 100%; padding: 10px; border: 2px dashed #d1d5db; color: #6b7280; background: none; border-radius: 8px; cursor: pointer; }
        .btn-add:hover { border-color: var(--primary); color: var(--primary); }

        /* RIGHT: PREVIEW PANEL */
        .preview-container {
            flex-grow: 1;
            background: #525659;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px;
            overflow-y: auto;
            height: 100vh;
            box-sizing: border-box;
        }

        #cv-paper {
            width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            color: #333;
            /* Default Layout */
            display: grid;
            grid-template-columns: 35% 65%;
        }

        /* --- MASTER LAYOUTS --- */
        
        /* 1. MODERN */
        [data-layout="modern"] { display: grid; grid-template-columns: 35% 65%; }
        [data-layout="modern"] .col-left { background: var(--cv-color); color: white; padding: 30px; }
        [data-layout="modern"] .col-right { padding: 30px; background: white; }
        [data-layout="modern"] .cv-name { color: var(--cv-color); }
        [data-layout="modern"] .section-title { color: var(--cv-color); border-bottom: 2px solid #eee; }
        [data-layout="modern"] .left-title { color: white; border-bottom: 1px solid rgba(255,255,255,0.3); }

        /* 2. CORPORATE */
        [data-layout="corporate"] { display: block !important; }
        [data-layout="corporate"] .header-banner { background: var(--cv-color); padding: 40px; color: white; text-align: center; display: block; }
        [data-layout="corporate"] .cv-name { color: white; margin-bottom: 5px; }
        [data-layout="corporate"] .cv-role { color: rgba(255,255,255,0.8); }
        [data-layout="corporate"] .section-title { color: var(--cv-color); border-bottom: 2px solid var(--cv-color); display: inline-block; margin-top: 20px;}
        [data-layout="corporate"] .col-left { background: white; color: #333; padding: 0; border-bottom: 1px solid #ddd; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        [data-layout="corporate"] .left-title { color: #333; font-weight: bold; text-decoration: underline; margin-bottom: 10px; display: block; width: 100%; grid-column: 1 / -1; }
        
        /* 3. CREATIVE */
        [data-layout="creative"] { display: grid; grid-template-columns: 60% 40%; }
        [data-layout="creative"] .col-right { background: #222; color: white; padding: 30px; order: 1; }
        [data-layout="creative"] .col-left { padding: 30px; order: 2; }
        [data-layout="creative"] .cv-name { font-size: 3rem; font-weight: 900; color: #222; }
        [data-layout="creative"] .section-title { background: var(--cv-color); color: white; padding: 5px 15px; display: inline-block; border-radius: 4px; }
        [data-layout="creative"] .left-title { color: var(--cv-color); font-size: 1.2rem; margin-top: 20px; }

        /* Common Elements */
        .header-banner { display: none; } /* Hidden by default */
        .cv-img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block; }
        .cv-name { font-size: 2.5rem; font-weight: bold; line-height: 1.1; }
        .cv-role { font-size: 1.2rem; opacity: 0.9; margin-bottom: 20px; text-transform: uppercase; }
        .section-title { font-size: 1.2rem; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; margin-top: 25px; padding-bottom: 5px; }
        .item-row { margin-bottom: 15px; }
        .item-title { font-weight: bold; font-size: 1.05rem; }
        .item-sub { font-size: 0.9rem; opacity: 0.8; font-style: italic; }
        .item-desc { font-size: 0.9rem; margin-top: 5px; line-height: 1.5; }
        .skill-pill { display: inline-block; padding: 4px 8px; background: rgba(0,0,0,0.1); margin: 2px; border-radius: 4px; font-size: 0.85rem; }
        
        .hidden-in-corp { display: block; }
        [data-layout="corporate"] .hidden-in-corp { display: none; }

    </style>
</head>
<body>

    <div id="landing-page" class="page active">
        <h1 class="hero-title">CV Forge.</h1>
        <p class="hero-subtitle">Build your professional career in minutes.</p>
        <button class="btn-main" onclick="goTo('login-page')">Create My CV</button>
    </div>

    <div id="login-page" class="page">
        <div class="login-card">
            <h2 style="color: var(--dark);">Welcome Back</h2>
            <p style="color: #666; font-size: 0.9rem;">Enter your details to access the dashboard</p>
            <input type="email" class="login-input" placeholder="Email Address">
            <input type="password" class="login-input" placeholder="Password">
            <button class="btn-main" style="width: 100%; border-radius: 10px;" onclick="goTo('app-page')">Login</button>
        </div>
    </div>

    <div id="app-page" class="page">
        
        <div class="editor">
            <h2 style="color: var(--primary);">CV Settings</h2>
            
            <label>Template Style</label>
            <select id="layoutSelect" onchange="updateSettings()">
                <option value="modern">Modern (Sidebar Left)</option>
                <option value="corporate">Corporate (Header Top)</option>
                <option value="creative">Creative (Sidebar Right)</option>
            </select>

            <label>Theme Color</label>
            <input type="color" id="colorPick" value="#2c3e50" oninput="updateSettings()">

            <label>CV Language</label>
            <select id="langSelect" onchange="updateLanguage()">
                <option value="en">English</option>
                <option value="fr">Français</option>
            </select>

            <div class="section-header"><span>Profile</span></div>
            <input type="file" onchange="uploadImg(event)">
            <input type="text" id="inp-name" placeholder="Full Name" oninput="render()">
            <input type="text" id="inp-role" placeholder="Job Title" oninput="render()">
            <textarea id="inp-summary" placeholder="Professional Summary" oninput="render()"></textarea>

            <div class="section-header"><span>Contact</span></div>
            <input type="text" id="inp-phone" placeholder="Phone" oninput="render()">
            <input type="text" id="inp-email" placeholder="Email" oninput="render()">
            <input type="text" id="inp-loc" placeholder="Location" oninput="render()">

            <div class="section-header"><span>Experience</span></div>
            <div id="list-exp"></div>
            <button class="btn-add" onclick="addItem('exp')">+ Add Job</button>

            <div class="section-header"><span>Education (Formation)</span></div>
            <div id="list-edu"></div>
            <button class="btn-add" onclick="addItem('edu')">+ Add Education</button>

            <div class="section-header"><span>Languages</span></div>
            <div id="list-lang"></div>
            <button class="btn-add" onclick="addItem('lang')">+ Add Language</button>

            <div class="section-header"><span>Certifications</span></div>
            <div id="list-cert"></div>
            <button class="btn-add" onclick="addItem('cert')">+ Add Certificate</button>

            <div class="section-header"><span>Skills (Comma separated)</span></div>
            <input type="text" id="inp-skills" oninput="render()">

            <button class="btn-main" style="width: 100%; border-radius: 8px; margin-top: 20px;" onclick="downloadPDF()">
                <i class="fa-solid fa-download"></i> Download PDF
            </button>
        </div>

        <div class="preview-container">
            <div id="cv-paper" data-layout="modern">
                <div class="header-banner">
                    <h1 class="cv-name hidden-in-modern hidden-in-creative" id="header-name">Your Name</h1>
                    <div class="cv-role hidden-in-modern hidden-in-creative" id="header-role">Job Title</div>
                </div>

                <div class="col-left">
                    <img src="https://via.placeholder.com/150" class="cv-img" id="out-img">
                    
                    <div class="hidden-in-corp">
                        <div class="left-title" id="lbl-contact">Contact</div>
                        <div style="font-size: 0.9rem; margin-bottom: 20px;">
                            <div id="out-phone"><i class="fas fa-phone"></i> </div>
                            <div id="out-email"><i class="fas fa-envelope"></i> </div>
                            <div id="out-loc"><i class="fas fa-map-marker-alt"></i> </div>
                        </div>
                    </div>

                    <div class="left-title" id="lbl-skills">Skills</div>
                    <div id="out-skills" style="margin-bottom: 20px;"></div>

                    <div class="left-title" id="lbl-lang">Languages</div>
                    <div id="out-lang"></div>
                </div>

                <div class="col-right">
                    <div class="hidden-in-corp">
                        <div class="cv-name" id="out-name">Your Name</div>
                        <div class="cv-role" id="out-role">Job Title</div>
                    </div>

                    <div class="section-title" id="lbl-profile">Profile</div>
                    <p class="item-desc" id="out-summary"></p>

                    <div class="section-title" id="lbl-exp">Experience</div>
                    <div id="out-exp"></div>

                    <div class="section-title" id="lbl-edu">Education</div>
                    <div id="out-edu"></div>

                    <div class="section-title" id="lbl-cert">Certifications</div>
                    <div id="out-cert"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. NAVIGATION ---
        function goTo(pageId) {
            // Remove active from all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            // Add active to specific page
            document.getElementById(pageId).classList.add('active');
            
            // If going to app, render defaults
            if(pageId === 'app-page') {
                updateSettings();
                render();
            }
        }

        // --- 2. LANGUAGE ---
        const translations = {
            en: { contact: "Contact", skills: "Skills", lang: "Languages", profile: "Profile", exp: "Experience", edu: "Education", cert: "Certifications" },
            fr: { contact: "Coordonnées", skills: "Compétences", lang: "Langues", profile: "Profil", exp: "Expérience", edu: "Formation", cert: "Certifications" }
        };

        function updateLanguage() {
            const lang = document.getElementById('langSelect').value;
            const t = translations[lang];
            
            document.getElementById('lbl-contact').innerText = t.contact;
            document.getElementById('lbl-skills').innerText = t.skills;
            document.getElementById('lbl-lang').innerText = t.lang;
            document.getElementById('lbl-profile').innerText = t.profile;
            document.getElementById('lbl-exp').innerText = t.exp;
            document.getElementById('lbl-edu').innerText = t.edu;
            document.getElementById('lbl-cert').innerText = t.cert;
        }

        // --- 3. SETTINGS ---
        function updateSettings() {
            const layout = document.getElementById('layoutSelect').value;
            const color = document.getElementById('colorPick').value;
            
            const paper = document.getElementById('cv-paper');
            paper.setAttribute('data-layout', layout);
            paper.style.setProperty('--cv-color', color);
        }

        function uploadImg(e) {
            const reader = new FileReader();
            reader.onload = (e) => document.getElementById('out-img').src = e.target.result;
            reader.readAsDataURL(e.target.files[0]);
        }

        // --- 4. DYNAMIC LISTS ---
        const data = { exp: [], edu: [], lang: [], cert: [] };

        function addItem(type) {
            const id = Date.now();
            data[type].push({ id });
            drawInputs(type);
        }

        function removeItem(type, id) {
            data[type] = data[type].filter(i => i.id !== id);
            drawInputs(type);
            render();
        }

        function drawInputs(type) {
            const container = document.getElementById(`list-${type}`);
            container.innerHTML = '';
            
            data[type].forEach(item => {
                let inputs = '';
                if(type === 'exp') {
                    inputs = `<input placeholder="Job Title" oninput="updateData('exp', ${item.id}, 'title', this.value)" value="${item.title || ''}">
                              <input placeholder="Company | Date" oninput="updateData('exp', ${item.id}, 'sub', this.value)" value="${item.sub || ''}">
                              <textarea placeholder="Description" oninput="updateData('exp', ${item.id}, 'desc', this.value)">${item.desc || ''}</textarea>`;
                } else if(type === 'edu') {
                    inputs = `<input placeholder="Degree" oninput="updateData('edu', ${item.id}, 'title', this.value)" value="${item.title || ''}">
                              <input placeholder="School | Year" oninput="updateData('edu', ${item.id}, 'sub', this.value)" value="${item.sub || ''}">`;
                } else if(type === 'lang') {
                    inputs = `<input placeholder="Language" oninput="updateData('lang', ${item.id}, 'title', this.value)" value="${item.title || ''}">
                              <select onchange="updateData('lang', ${item.id}, 'sub', this.value)">
                                <option value="">Select Level</option><option>Native</option><option>Fluent</option><option>Intermediate</option>
                              </select>`;
                } else if(type === 'cert') {
                    inputs = `<input placeholder="Certificate Name" oninput="updateData('cert', ${item.id}, 'title', this.value)" value="${item.title || ''}">
                              <input placeholder="Issuer | Year" oninput="updateData('cert', ${item.id}, 'sub', this.value)" value="${item.sub || ''}">`;
                }

                container.innerHTML += `
                    <div class="dynamic-item">
                        <button class="btn-del" onclick="removeItem('${type}', ${item.id})">X</button>
                        ${inputs}
                    </div>`;
            });
        }

        function updateData(type, id, field, value) {
            const item = data[type].find(i => i.id === id);
            if(item) { item[field] = value; render(); }
        }

        // --- 5. RENDER ---
        function render() {
            // Main Text
            const name = document.getElementById('inp-name').value || "Your Name";
            const role = document.getElementById('inp-role').value || "Job Title";
            
            document.getElementById('out-name').innerText = name;
            document.getElementById('header-name').innerText = name; // For corporate header
            
            document.getElementById('out-role').innerText = role;
            document.getElementById('header-role').innerText = role; // For corporate header
            
            document.getElementById('out-summary').innerText = document.getElementById('inp-summary').value || "Summary...";
            document.getElementById('out-phone').innerHTML = '<i class="fas fa-phone"></i> ' + (document.getElementById('inp-phone').value || "+123456789");
            document.getElementById('out-email').innerHTML = '<i class="fas fa-envelope"></i> ' + (document.getElementById('inp-email').value || "email@example.com");
            document.getElementById('out-loc').innerHTML = '<i class="fas fa-map-marker-alt"></i> ' + (document.getElementById('inp-loc').value || "Location");

            // Skills
            const skills = document.getElementById('inp-skills').value.split(',');
            document.getElementById('out-skills').innerHTML = skills.map(s => s.trim() ? `<span class="skill-pill">${s.trim()}</span>` : '').join('');

            // Lists
            renderList('exp', document.getElementById('out-exp'));
            renderList('edu', document.getElementById('out-edu'));
            renderList('cert', document.getElementById('out-cert'));
            
            // Languages
            const langContainer = document.getElementById('out-lang');
            langContainer.innerHTML = data.lang.map(i => `
                <div style="margin-bottom:5px;"><strong>${i.title || ''}</strong> <span style="font-size:0.8em; opacity:0.8">(${i.sub || ''})</span></div>
            `).join('');
        }

        function renderList(type, container) {
            container.innerHTML = data[type].map(i => `
                <div class="item-row">
                    <div class="item-title">${i.title || ''}</div>
                    <div class="item-sub">${i.sub || ''}</div>
                    ${i.desc ? `<div class="item-desc">${i.desc.replace(/\n/g, '<br>')}</div>` : ''}
                </div>
            `).join('');
        }

        // --- 6. DOWNLOAD ---
        function downloadPDF() {
            const element = document.getElementById('cv-paper');
            const opt = {
                margin: 0,
                filename: 'my-cv.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        // Init Language
        updateLanguage();
    </script>
</body>
</html>