<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Forge - Real Google Auth</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* [KEEPING STYLES THE SAME AS BEFORE FOR CONSISTENCY] */
        :root { --primary: #4f46e5; --secondary: #818cf8; --dark: #1f2937; --light: #f3f4f6; }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: var(--light); height: 100vh; overflow: hidden; }
        .page { display: none !important; height: 100vh; width: 100%; }
        .page.active { display: flex !important; }

        /* Landing */
        #landing-page { background: linear-gradient(135deg, #111827 0%, #1f2937 100%); color: white; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .hero-title { font-size: 3.5rem; margin: 0; background: linear-gradient(to right, #818cf8, #c7d2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-main { padding: 15px 40px; font-size: 1.1rem; background: var(--primary); color: white; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px;}

        /* Login */
        #login-page { background: #f0f2f5; align-items: center; justify-content: center; }
        .login-card { background: white; padding: 50px 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 380px; text-align: center; }
        .btn-google { display: flex; align-items: center; justify-content: center; background: white; color: #3c4043; border: 1px solid #dadce0; border-radius: 40px; padding: 12px; font-size: 1rem; cursor: pointer; width: 100%; margin-top: 20px; }
        .btn-google:hover { background: #f7f8f8; }
        .google-icon { width: 20px; height: 20px; margin-right: 12px; }

        /* App Layout */
        #app-page { flex-direction: row; }
        .editor { width: 450px; background: white; border-right: 1px solid #ddd; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; height: 100vh; box-sizing: border-box; }
        .preview-container { flex-grow: 1; background: #525659; display: flex; justify-content: center; align-items: flex-start; padding: 40px; overflow-y: auto; height: 100vh; box-sizing: border-box; }
        
        /* Basic Form Styles */
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px; box-sizing: border-box; }
        .section-header { font-weight: bold; margin-top: 15px; border-bottom: 1px solid #eee; }

        /* User Badge */
        .user-profile-badge { display: flex; align-items: center; padding: 10px; background: #f3f4f6; border-radius: 8px; margin-bottom: 20px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
        .user-info { display: flex; flex-direction: column; text-align: left;}
        .user-name { font-size: 0.9rem; font-weight: bold; }
        .user-email { font-size: 0.75rem; color: #666; }

        /* CV Preview Styles */
        #cv-paper { width: 210mm; min-height: 297mm; background: white; box-shadow: 0 0 50px rgba(0,0,0,0.5); display: grid; grid-template-columns: 35% 65%; }
        .col-left { background: #2c3e50; color: white; padding: 30px; }
        .col-right { padding: 30px; }
        .cv-img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block; }
        .cv-name { font-size: 2.5rem; font-weight: bold; }
    </style>
</head>
<body>

    <div id="landing-page" class="page active">
        <h1 class="hero-title">CV Forge</h1>
        <p>Real Google Authentication Enabled</p>
        <button class="btn-main" onclick="goTo('login-page')">Login / Signup</button>
    </div>

    <div id="login-page" class="page">
        <div class="login-card">
            <h2>Welcome</h2>
            <p>Sign in to save your data</p>
            <button class="btn-google" onclick="loginWithGoogle()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" class="google-icon">
                Sign in with Google
            </button>
            <p id="error-msg" style="color: red; font-size: 0.8rem; display: none; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="app-page" class="page">
        <div class="editor">
            <div class="user-profile-badge" id="user-badge">
                <img src="" class="user-avatar" id="badge-img">
                <div class="user-info">
                    <span class="user-name" id="badge-name">User</span>
                    <span class="user-email" id="badge-email">email@test.com</span>
                </div>
                <button onclick="logout()" style="margin-left:auto; cursor:pointer; color:red; border:none; background:none;">Logout</button>
            </div>

            <div class="section-header">Profile</div>
            <input type="text" id="inp-name" placeholder="Full Name" oninput="render()">
            <input type="text" id="inp-role" placeholder="Job Title" oninput="render()">
            
            <div class="section-header">Contact</div>
            <input type="text" id="inp-email" placeholder="Email" oninput="render()">
            <input type="text" id="inp-phone" placeholder="Phone" oninput="render()">

            <button class="btn-main" style="width:100%" onclick="downloadPDF()">Download PDF</button>
        </div>

        <div class="preview-container">
            <div id="cv-paper">
                <div class="col-left">
                    <img src="https://via.placeholder.com/150" class="cv-img" id="out-img">
                    <h3>Contact</h3>
                    <div id="out-email"></div>
                    <div id="out-phone"></div>
                </div>
                <div class="col-right">
                    <div class="cv-name" id="out-name"></div>
                    <div id="out-role"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // 1. FIREBASE CONFIGURATION (PASTE YOUR KEYS HERE!)
        // ---------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyDbLfhmlq5JAwoM-PrymV5XJwb_gMDdlS0",
  authDomain: "cv-builder-14a81.firebaseapp.com",
  projectId: "cv-builder-14a81",
  storageBucket: "cv-builder-14a81.firebasestorage.app",
  messagingSenderId: "54650982350",
  appId: "1:54650982350:web:002ef16d6251f1f471a59f",
  measurementId: "G-25CZLCSSC0"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        // ---------------------------------------------------------
        // 2. AUTHENTICATION LOGIC
        // ---------------------------------------------------------
        
        // Listen for login state changes (Runs automatically)
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in.
                console.log("User Logged In:", user.email);
                loadApp(user);
            } else {
                // No user is signed in.
                console.log("No User");
            }
        });

        function loginWithGoogle() {
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Successful login! onAuthStateChanged will handle the rest
                }).catch((error) => {
                    console.error(error);
                    const errorMsg = document.getElementById('error-msg');
                    errorMsg.innerText = "Login Failed: " + error.message;
                    errorMsg.style.display = 'block';
                });
        }

        function logout() {
            auth.signOut().then(() => {
                goTo('landing-page');
                // Clear fields
                document.getElementById('inp-name').value = "";
                document.getElementById('inp-email').value = "";
                render();
            });
        }

        function loadApp(user) {
            goTo('app-page');
            
            // Fill Sidebar Badge
            document.getElementById('badge-name').innerText = user.displayName;
            document.getElementById('badge-email').innerText = user.email;
            document.getElementById('badge-img').src = user.photoURL;

            // Auto-Fill CV Form
            document.getElementById('inp-name').value = user.displayName;
            document.getElementById('inp-email').value = user.email;
            document.getElementById('out-img').src = user.photoURL;
            
            render();
        }

        // ---------------------------------------------------------
        // 3. APP LOGIC
        // ---------------------------------------------------------
        function goTo(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function render() {
            document.getElementById('out-name').innerText = document.getElementById('inp-name').value;
            document.getElementById('out-role').innerText = document.getElementById('inp-role').value;
            document.getElementById('out-email').innerText = document.getElementById('inp-email').value;
            document.getElementById('out-phone').innerText = document.getElementById('inp-phone').value;
        }

        function downloadPDF() {
            const element = document.getElementById('cv-paper');
            html2pdf().from(element).save();
        }

    </script>
</body>
</html>